<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.1-SNAPSHOT Documentation: Building Flink</title>
    <link rel="shortcut icon" href="/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/page/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/page/css/flink.css">
    <link rel="stylesheet" href="/page/css/syntax.css">
    <link rel="stylesheet" href="/page/css/codetabs.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    
    





    <!-- Top navbar. -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <!-- The logo. -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="navbar-logo">
            <a href="http://flink.apache.org"><img alt="Apache Flink" src="/page/img/navbar-brand-logo.jpg"></a>
          </div>
        </div><!-- /.navbar-header -->

        <!-- The navigation links. -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li class="hidden-sm "><a href="/">中文文档 1.1</a></li>

            <!-- Quickstart -->
            <li class="dropdown">
              <a href="/quickstart" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">快速起步<span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/quickstart/setup_quickstart.html">安装</a></li>
                
                <li class=""><a href="/quickstart/run_example_quickstart.html">Run Example</a></li>
                
                <li class=""><a href="/quickstart/java_api_quickstart.html">Java API</a></li>
                
                <li class=""><a href="/quickstart/scala_api_quickstart.html">Scala API</a></li>
                
              </ul>
            </li>

            <!-- Setup -->
            <li class="dropdown active">
              <a href="/setup" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">安装 <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class="active"><a href="/setup/building.html">Build Flink</a></li>
                
                <li class=""><a href="/setup/config.html">Configuration</a></li>
                

                <li class="divider"></li>
                <li role="presentation" class="dropdown-header"><strong>部署</strong></li>
                
                
                <li class=""><a href="/setup/local_setup.html">本地</a></li>
                
                <li class=""><a href="/setup/cluster_setup.html">集群 (Standalone)</a></li>
                
                <li class=""><a href="/setup/yarn_setup.html">YARN</a></li>
                
                <li class=""><a href="/setup/gce_setup.html">Google Compute Engine</a></li>
                
                <li class=""><a href="/setup/jobmanager_high_availability.html">High Availability</a></li>
                
              </ul>
            </li>

            <!-- Programming Guides -->
            <li class="dropdown">
              <a href="/apis" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">编程指南 <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/apis/common/"><strong>Basic Concepts</strong></a></li>
                
                <li class=""><a href="/apis/streaming/"><strong>Streaming 指南</strong> (DataStream API)</a></li>
                
                <li class=""><a href="/apis/batch/"><strong>Batch Guide</strong> (DataSet API)</a></li>
                
                <li class=""><a href="/apis/connectors.html">Connectors</a></li>
                
                <li class=""><a href="/apis/best_practices.html">Best Practices</a></li>
                
                <li class=""><a href="/apis/cli.html">Command-Line Interface</a></li>
                
                <li class=""><a href="/apis/local_execution.html">Local Execution</a></li>
                
                <li class=""><a href="/apis/cluster_execution.html">Cluster Execution</a></li>
                
                <li class=""><a href="/apis/scala_shell.html">Scala Shell</a></li>
                
                <li class=""><a href="/apis/java8.html">Java 8</a></li>
                
              </ul>
            </li>

            <!-- Libraries -->
            <li class="dropdown">
              <a href="/libs" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">库 <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  
                  
                  <li class=""><a href="/apis/batch/libs/gelly.html">Graphs: Gelly</a></li>
                  
                  <li class=""><a href="/apis/streaming/libs/cep.html">CEP</a></li>
                  
                  <li class=""><a href="/apis/batch/libs/ml/">Machine Learning</a></li>
                  
                  <li class=""><a href="/apis/batch/libs/table.html">Relational: Table</a></li>
                  
              </ul>
            </li>

            <!-- Internals -->
            <li class="dropdown">
              <a href="/internals" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">内部 <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li role="presentation" class="dropdown-header"><strong>Contribute</strong></li>
                <li><a href="http://flink.apache.org/how-to-contribute.html"><small><span class="glyphicon glyphicon-new-window"></span></small> How to Contribute</a></li>
                <li><a href="http://flink.apache.org/contribute-code.html#coding-guidelines"><small><span class="glyphicon glyphicon-new-window"></span></small> Coding Guidelines</a></li>
                
                
                <li class=""><a href="/internals/ide_setup.html">IDE Setup</a></li>
                
                <li class=""><a href="/internals/logging.html">Logging</a></li>
                
                <li class=""><a href="/internals/general_arch.html">Architecture and Process Model</a></li>
                
                <li class=""><a href="/internals/stream_checkpointing.html">Fault Tolerance for Data Streaming</a></li>
                
                <li class=""><a href="/internals/types_serialization.html">Type Extraction and Serialization</a></li>
                
                <li class=""><a href="/internals/monitoring_rest_api.html">Monitoring REST API</a></li>
                
                <li class=""><a href="/internals/job_scheduling.html">Jobs and Scheduling</a></li>
                
                <li class=""><a href="/internals/add_operator.html">How-To: Add an Operator</a></li>
                
              </ul>
            </li>

            <li class="hidden-sm "><a href="/about/">关于本站</a></li>

          </ul>
          <form class="navbar-form navbar-right hidden-sm hidden-md" role="search" action="/search-results.html">
            <div class="form-group">
              <input type="text" class="form-control" size="16px" name="q" placeholder="Search all pages">
            </div>
            <button type="submit" class="btn btn-default">Search</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container -->
    </nav>


    

    <!-- Main content. -->
    <div class="container">
      
      
<div class="row">

  
  <div class="col-md-8 col-md-offset-2 text">
    <!-- Artifact name change warning. Remove for the 1.0 release. -->
    
    <div class="panel panel-default">
      <div class="panel-body"><strong>重要</strong>: 依赖于Scala的maven artifacts现在会添加一个Scala主版本的后缀，例如 "2.10" 或 "2.11". 请查阅<a href="https://cwiki.apache.org/confluence/display/FLINK/Maven+artifact+names+suffixed+with+Scala+version">迁移指南</a>.</div>
    </div>
    

    <h1>Building Flink</h1>


<p>本文主要介绍如何如何从源代码构建 Flink 1.1-SNAPSHOT。</p>

<ul id="markdown-toc">
  <li><a href="#build-flink" id="markdown-toc-build-flink">Build Flink</a></li>
  <li><a href="#hadoop-versions" id="markdown-toc-hadoop-versions">Hadoop Versions</a>    <ul>
      <li><a href="#hadoop-1" id="markdown-toc-hadoop-1">Hadoop 1</a></li>
      <li><a href="#hadoop-2" id="markdown-toc-hadoop-2">Hadoop 2</a></li>
      <li><a href="#vendor-specific-versions" id="markdown-toc-vendor-specific-versions">Vendor-specific Versions</a></li>
    </ul>
  </li>
  <li><a href="#scala-versions" id="markdown-toc-scala-versions">Scala Versions</a></li>
  <li><a href="#encrypted-file-systems" id="markdown-toc-encrypted-file-systems">Encrypted File Systems</a></li>
  <li><a href="#internals" id="markdown-toc-internals">Internals</a></li>
</ul>

<h2 id="build-flink">Build Flink</h2>

<p>In order to build Flink you need the source code. Either <a href="http://flink.apache.org/downloads.html">download the source of a release</a> or <a href="https://github.com/apache/flink">clone the git repository</a>.</p>

<p>In addition you need <strong>Maven 3</strong> and a <strong>JDK</strong> (Java Development Kit). Flink requires <strong>at least Java 7</strong> to build. We recommend using Java 8.</p>

<p>To clone from git, enter:</p>

<div class="highlight"><pre><code class="language-bash">git clone https://github.com/apache/flink</code></pre></div>

<p>The simplest way of building Flink is by running:</p>

<div class="highlight"><pre><code class="language-bash">mvn clean install -DskipTests</code></pre></div>

<p>This instructs <a href="http://maven.apache.org">Maven</a> (<code>mvn</code>) to first remove all existing builds (<code>clean</code>) and then create a new Flink binary (<code>install</code>). The <code>-DskipTests</code> command prevents Maven from executing the tests.</p>

<p>The default build includes the YARN Client for Hadoop 2.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="hadoop-versions">Hadoop Versions</h2>

<p><span class="label label-info">Info</span> Most users do not need to do this manually. The <a href="http://flink.apache.org/downloads.html">download page</a>  contains binary packages for common Hadoop versions.</p>

<p>Flink has dependencies to HDFS and YARN which are both dependencies from <a href="http://hadoop.apache.org">Apache Hadoop</a>. There exist many different versions of Hadoop (from both the upstream project and the different Hadoop distributions). If you are using a wrong combination of versions, exceptions can occur.</p>

<p>There are two main versions of Hadoop that we need to differentiate:
- <strong>Hadoop 1</strong>, with all versions starting with zero or one, like <em>0.20</em>, <em>0.23</em> or <em>1.2.1</em>.
- <strong>Hadoop 2</strong>, with all versions starting with 2, like <em>2.6.0</em>.</p>

<p>The main differentiation between Hadoop 1 and Hadoop 2 is the availability of <a href="https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/YARN.html">Hadoop YARN</a>, Hadoop’s cluster resource manager.</p>

<p><strong>By default, Flink is using the Hadoop 2 dependencies</strong>.</p>

<h3 id="hadoop-1">Hadoop 1</h3>

<p>To build Flink for Hadoop 1, issue the following command:</p>

<div class="highlight"><pre><code class="language-bash">mvn clean install -DskipTests -Dhadoop.profile<span class="o">=</span>1</code></pre></div>

<p>The <code>-Dhadoop.profile=1</code> flag instructs Maven to build Flink for Hadoop 1. Note that the features included in Flink change when using a different Hadoop profile. In particular, there is no support for YARN and HBase in Hadoop 1 builds.</p>

<h3 id="hadoop-2">Hadoop 2</h3>

<p>You can also specify a specific Hadoop version to build against:</p>

<div class="highlight"><pre><code class="language-bash">mvn clean install -DskipTests -Dhadoop.version<span class="o">=</span>2.4.1</code></pre></div>

<h4 id="before-hadoop-220">Before Hadoop 2.2.0</h4>

<p>Maven will automatically build Flink with its YARN client. The 2.2.0 Hadoop release is <em>not</em> supported by Flink’s YARN client. Therefore, you need to exclude the YARN client with the following string: <code>-P!include-yarn</code>.</p>

<p>So if you are building Flink for Hadoop <code>2.0.0-alpha</code>, use the following command:</p>

<div class="highlight"><pre><code class="language-bash">mvn clean install -P!include-yarn -Dhadoop.version<span class="o">=</span>2.0.0-alpha</code></pre></div>

<h3 id="vendor-specific-versions">Vendor-specific Versions</h3>

<p>To build Flink against a vendor specific Hadoop version, issue the following command:</p>

<div class="highlight"><pre><code class="language-bash">mvn clean install -DskipTests -Pvendor-repos -Dhadoop.version<span class="o">=</span>2.2.0-cdh5.0.0-beta-2</code></pre></div>

<p>The <code>-Pvendor-repos</code> activates a Maven <a href="http://maven.apache.org/guides/introduction/introduction-to-profiles.html">build profile</a> that includes the repositories of popular Hadoop vendors such as Cloudera, Hortonworks, or MapR.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="scala-versions">Scala Versions</h2>

<p><span class="label label-info">Info</span> Users that purely use the Java APIs and libraries can <em>ignore</em> this section.</p>

<p>Flink has APIs, libraries, and runtime modules written in <a href="http://scala-lang.org">Scala</a>. Users of the Scala API and libraries may have to match the Scala version of Flink with the Scala version of their projects (because Scala is not strictly backwards compatible).</p>

<p><strong>By default, Flink is built with the Scala 2.10</strong>. To build Flink with Scala <em>2.11</em>, you can change the default Scala <em>binary version</em> with the following script:</p>

<div class="highlight"><pre><code class="language-bash"><span class="c"># Switch Scala binary version between 2.10 and 2.11</span>
tools/change-scala-version.sh 2.11
<span class="c"># Build with Scala version 2.11</span>
mvn clean install -DskipTests</code></pre></div>

<p>To build against custom Scala versions, you need to switch to the appropriate binary version and supply the <em>language version</em> as an additional build property. For example, to build against Scala 2.11.4, you have to execute:</p>

<div class="highlight"><pre><code class="language-bash"><span class="c"># Switch Scala binary version to 2.11</span>
tools/change-scala-version.sh 2.11
<span class="c"># Build with custom Scala version 2.11.4</span>
mvn clean install -DskipTests -Dscala.version<span class="o">=</span>2.11.4</code></pre></div>

<p>Flink is developed against Scala <em>2.10</em> and tested additionally against Scala <em>2.11</em>. These two versions are known to be compatible. Earlier versions (like Scala <em>2.9</em>) are <em>not</em> compatible.</p>

<p>Newer versions may be compatible, depending on breaking changes in the language features used by Flink, and the availability of Flink’s dependencies in those Scala versions. The dependencies written in Scala include for example <em>Kafka</em>, <em>Akka</em>, <em>Scalatest</em>, and <em>scopt</em>.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="encrypted-file-systems">Encrypted File Systems</h2>

<p>If your home directory is encrypted you might encounter a <code>java.io.IOException: File name too long</code> exception. Some encrypted file systems, like encfs used by Ubuntu, do not allow long filenames, which is the cause of this error.</p>

<p>The workaround is to add:</p>

<div class="highlight"><pre><code class="language-xml"><span class="nt">&lt;args&gt;</span>
    <span class="nt">&lt;arg&gt;</span>-Xmax-classfile-name<span class="nt">&lt;/arg&gt;</span>
    <span class="nt">&lt;arg&gt;</span>128<span class="nt">&lt;/arg&gt;</span>
<span class="nt">&lt;/args&gt;</span></code></pre></div>

<p>in the compiler configuration of the <code>pom.xml</code> file of the module causing the error. For example, if the error appears in the <code>flink-yarn</code> module, the above code should be added under the <code>&lt;configuration&gt;</code> tag of <code>scala-maven-plugin</code>. See <a href="https://issues.apache.org/jira/browse/FLINK-2003">this issue</a> for more information.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="internals">Internals</h2>

<p>The builds with Maven are controlled by <a href="http://maven.apache.org/pom.html#Properties">properties</a> and <a href="http://maven.apache.org/guides/introduction/introduction-to-profiles.html">build profiles</a>. There are two profiles, one for <code>hadoop1</code> and one for <code>hadoop2</code>. When the <code>hadoop2</code> profile is enabled (default), the system will also build the YARN client.</p>

<p>To enable the <code>hadoop1</code> profile, set <code>-Dhadoop.profile=1</code> when building. Depending on the profile, there are two Hadoop versions, set via properties. For <code>hadoop1</code>, we use 1.2.1 by default, for <code>hadoop2</code> it is 2.3.0.</p>

<p>You can change these versions with the <code>hadoop-two.version</code> (or <code>hadoop-one.version</code>) property. For example <code>-Dhadoop-two.version=2.4.0</code>.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

     <div class="footer">
      发现错误？想参与编辑？
      <a href="https://github.com/wuchong/flink-china-doc/edit/master/setup/building.md" target="_blank">
        在 Github 上编辑此页！
      </a>
    </div>
  </div>

  
</div>

    </div><!-- /.container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="/page/js/codetabs.js"></script>

    <!-- Google Analytics -->
    <!-- script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script -->

    <!-- Baidu Analytics -->
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?835985ad7943d8c24bc3c1f155b7d4a2";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    </script>


    <!-- Disqus -->
    
  </body>
</html>
