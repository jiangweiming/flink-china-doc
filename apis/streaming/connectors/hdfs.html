<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.1-SNAPSHOT Documentation: HDFS Connector</title>
    <link rel="shortcut icon" href="/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/page/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/page/css/flink.css">
    <link rel="stylesheet" href="/page/css/syntax.css">
    <link rel="stylesheet" href="/page/css/codetabs.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    
    





    <!-- Top navbar. -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <!-- The logo. -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="navbar-logo">
            <a href="http://flink.apache.org"><img alt="Apache Flink" src="/page/img/navbar-brand-logo.jpg"></a>
          </div>
        </div><!-- /.navbar-header -->

        <!-- The navigation links. -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li class="hidden-sm "><a href="/">中文文档 1.1</a></li>

            <!-- Quickstart -->
            <li class="dropdown">
              <a href="/quickstart" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">快速起步<span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/quickstart/setup_quickstart.html">安装</a></li>
                
                <li class=""><a href="/quickstart/run_example_quickstart.html">Run Example</a></li>
                
                <li class=""><a href="/quickstart/java_api_quickstart.html">Java API</a></li>
                
                <li class=""><a href="/quickstart/scala_api_quickstart.html">Scala API</a></li>
                
              </ul>
            </li>

            <!-- Setup -->
            <li class="dropdown">
              <a href="/setup" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">安装 <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/setup/building.html">Build Flink</a></li>
                
                <li class=""><a href="/setup/config.html">Configuration</a></li>
                

                <li class="divider"></li>
                <li role="presentation" class="dropdown-header"><strong>部署</strong></li>
                
                
                <li class=""><a href="/setup/local_setup.html">本地</a></li>
                
                <li class=""><a href="/setup/cluster_setup.html">集群 (Standalone)</a></li>
                
                <li class=""><a href="/setup/yarn_setup.html">YARN</a></li>
                
                <li class=""><a href="/setup/gce_setup.html">Google Compute Engine</a></li>
                
                <li class=""><a href="/setup/jobmanager_high_availability.html">High Availability</a></li>
                
              </ul>
            </li>

            <!-- Programming Guides -->
            <li class="dropdown active">
              <a href="/apis" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">编程指南 <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/apis/common/"><strong>Basic Concepts</strong></a></li>
                
                <li class="active"><a href="/apis/streaming/"><strong>Streaming 指南</strong> (DataStream API)</a></li>
                
                <li class=""><a href="/apis/batch/"><strong>Batch Guide</strong> (DataSet API)</a></li>
                
                <li class=""><a href="/apis/connectors.html">Connectors</a></li>
                
                <li class=""><a href="/apis/best_practices.html">Best Practices</a></li>
                
                <li class=""><a href="/apis/cli.html">Command-Line Interface</a></li>
                
                <li class=""><a href="/apis/local_execution.html">Local Execution</a></li>
                
                <li class=""><a href="/apis/cluster_execution.html">Cluster Execution</a></li>
                
                <li class=""><a href="/apis/scala_shell.html">Scala Shell</a></li>
                
                <li class=""><a href="/apis/java8.html">Java 8</a></li>
                
              </ul>
            </li>

            <!-- Libraries -->
            <li class="dropdown">
              <a href="/libs" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">库 <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  
                  
                  <li class=""><a href="/apis/batch/libs/gelly.html">Graphs: Gelly</a></li>
                  
                  <li class=""><a href="/apis/streaming/libs/cep.html">CEP</a></li>
                  
                  <li class=""><a href="/apis/batch/libs/ml/">Machine Learning</a></li>
                  
                  <li class=""><a href="/apis/batch/libs/table.html">Relational: Table</a></li>
                  
              </ul>
            </li>

            <!-- Internals -->
            <li class="dropdown">
              <a href="/internals" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">内部 <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li role="presentation" class="dropdown-header"><strong>Contribute</strong></li>
                <li><a href="http://flink.apache.org/how-to-contribute.html"><small><span class="glyphicon glyphicon-new-window"></span></small> How to Contribute</a></li>
                <li><a href="http://flink.apache.org/contribute-code.html#coding-guidelines"><small><span class="glyphicon glyphicon-new-window"></span></small> Coding Guidelines</a></li>
                
                
                <li class=""><a href="/internals/ide_setup.html">IDE Setup</a></li>
                
                <li class=""><a href="/internals/logging.html">Logging</a></li>
                
                <li class=""><a href="/internals/general_arch.html">Architecture and Process Model</a></li>
                
                <li class=""><a href="/internals/stream_checkpointing.html">Fault Tolerance for Data Streaming</a></li>
                
                <li class=""><a href="/internals/types_serialization.html">Type Extraction and Serialization</a></li>
                
                <li class=""><a href="/internals/monitoring_rest_api.html">Monitoring REST API</a></li>
                
                <li class=""><a href="/internals/job_scheduling.html">Jobs and Scheduling</a></li>
                
                <li class=""><a href="/internals/add_operator.html">How-To: Add an Operator</a></li>
                
              </ul>
            </li>

            <li class="hidden-sm "><a href="/about/">关于本站</a></li>

          </ul>
          <form class="navbar-form navbar-right hidden-sm hidden-md" role="search" action="/search-results.html">
            <div class="form-group">
              <input type="text" class="form-control" size="16px" name="q" placeholder="Search all pages">
            </div>
            <button type="submit" class="btn btn-default">Search</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container -->
    </nav>


    

    <!-- Main content. -->
    <div class="container">
      
      
<div class="row">


  <!-- Sub Navigation -->
  <div class="col-sm-3">
    <ul id="sub-nav">
      
      
      
        
        <li><a href="/apis/streaming/" class="active">DataStream API</a>
          
        </li>
      
        
        <li><a href="/apis/streaming/windows.html" class="">Windows</a>
          
          <ul>
            
              <li><a href="/apis/streaming/time.html" class="">Working with Time</a></li>
            
          </ul>
          
        </li>
      
        
        <li><a href="/apis/streaming/fault_tolerance.html" class="">Fault Tolerance</a>
          
          <ul>
            
              <li><a href="/apis/streaming/state.html" class="">Working with State</a></li>
            
              <li><a href="/apis/streaming/state_backends.html" class="">State Backends</a></li>
            
          </ul>
          
        </li>
      
        
        <li><a href="/apis/streaming/savepoints.html" class="">Savepoints</a>
          
        </li>
      
        
        <li><a href="/apis/streaming/connectors/" class="active">Connectors</a>
          
          <ul>
            
              <li><a href="/apis/streaming/connectors/kafka.html" class="">Kafka</a></li>
            
              <li><a href="/apis/streaming/connectors/elasticsearch.html" class="">Elasticsearch</a></li>
            
              <li><a href="/apis/streaming/connectors/hdfs.html" class="active">HDFS</a></li>
            
              <li><a href="/apis/streaming/connectors/rabbitmq.html" class="">RabbitMQ</a></li>
            
              <li><a href="/apis/streaming/connectors/twitter.html" class="">Twitter</a></li>
            
          </ul>
          
        </li>
      
        
        <li><a href="/apis/streaming/libs/" class="">Libraries</a>
          
          <ul>
            
              <li><a href="/apis/streaming/libs/cep.html" class="">Event Processing (CEP)</a></li>
            
          </ul>
          
        </li>
      
        
        <li><a href="/apis/streaming/storm_compatibility.html" class="">Storm Compatibility</a>
          
        </li>
      
    </ul>
  </div>
  <!-- Main -->
  <div class="col-sm-9">
    <!-- Top anchor -->
    <a href="#top"></a>

    <!-- Artifact name change warning. Remove for the 1.0 release. -->
    
    <div class="panel panel-default">
      <div class="panel-body"><strong>重要</strong>: 依赖于Scala的maven artifacts现在会添加一个Scala主版本的后缀，例如 "2.10" 或 "2.11". 请查阅<a href="https://cwiki.apache.org/confluence/display/FLINK/Maven+artifact+names+suffixed+with+Scala+version">迁移指南</a>.</div>
    </div>
    

    <!-- Breadcrumbs above the main heading -->
    <ol class="breadcrumb">
      
      
      <li><a href="/apis/streaming/">Streaming 指南</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      

      
      
      

      

      <li><a href="/apis/streaming/connectors/">Connectors</a></li>
      
      
      <li class="active">HDFS</li>
    </ol>

    <div class="text">
      <!-- Main heading -->
      <h1>HDFS Connector</h1>

      <!-- Content -->
      

<p>This connector provides a Sink that writes rolling files to any filesystem supported by
Hadoop FileSystem. To use this connector, add the
following dependency to your project:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apache.flink<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>flink-connector-filesystem_2.10<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure>

<p>Note that the streaming connectors are currently not part of the binary
distribution. See
<a href="/apis/cluster_execution.html#linking-with-modules-not-contained-in-the-binary-distribution">here</a>
for information about how to package the program with the libraries for
cluster execution.</p>

<h4 id="rolling-file-sink">Rolling File Sink</h4>

<p>The rolling behaviour as well as the writing can be configured but we will get to that later.
This is how you can create a default rolling sink:</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">DataStream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">input</span> <span class="o">=</span> <span class="o">...;</span>

<span class="n">input</span><span class="o">.</span><span class="na">addSink</span><span class="o">(</span><span class="k">new</span> <span class="n">RollingSink</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="s">&quot;/base/path&quot;</span><span class="o">));</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">input</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="n">input</span><span class="o">.</span><span class="n">addSink</span><span class="o">(</span><span class="k">new</span> <span class="nc">RollingSink</span><span class="o">(</span><span class="s">&quot;/base/path&quot;</span><span class="o">))</span></code></pre></figure>

  </div>
</div>

<p>The only required parameter is the base path where the rolling files (buckets) will be
stored. The sink can be configured by specifying a custom bucketer, writer and batch size.</p>

<p>By default the rolling sink will use the pattern <code>"yyyy-MM-dd--HH"</code> to name the rolling buckets.
This pattern is passed to <code>SimpleDateFormat</code> with the current system time to form a bucket path. A
new bucket will be created whenever the bucket path changes. For example, if you have a pattern
that contains minutes as the finest granularity you will get a new bucket every minute.
Each bucket is itself a directory that contains several part files: Each parallel instance
of the sink will create its own part file and when part files get too big the sink will also
create a new part file next to the others. To specify a custom bucketer use <code>setBucketer()</code>
on a <code>RollingSink</code>.</p>

<p>The default writer is <code>StringWriter</code>. This will call <code>toString()</code> on the incoming elements
and write them to part files, separated by newline. To specify a custom writer use <code>setWriter()</code>
on a <code>RollingSink</code>. If you want to write Hadoop SequenceFiles you can use the provided
<code>SequenceFileWriter</code> which can also be configured to use compression.</p>

<p>The last configuration option is the batch size. This specifies when a part file should be closed
and a new one started. (The default part file size is 384 MB).</p>

<p>Example:</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">IntWritable</span><span class="o">,</span><span class="n">Text</span><span class="o">&gt;&gt;</span> <span class="n">input</span> <span class="o">=</span> <span class="o">...;</span>

<span class="n">RollingSink</span> <span class="n">sink</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RollingSink</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="s">&quot;/base/path&quot;</span><span class="o">);</span>
<span class="n">sink</span><span class="o">.</span><span class="na">setBucketer</span><span class="o">(</span><span class="k">new</span> <span class="nf">DateTimeBucketer</span><span class="o">(</span><span class="s">&quot;yyyy-MM-dd--HHmm&quot;</span><span class="o">));</span>
<span class="n">sink</span><span class="o">.</span><span class="na">setWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">SequenceFileWriter</span><span class="o">&lt;</span><span class="n">IntWritable</span><span class="o">,</span> <span class="n">Text</span><span class="o">&gt;());</span>
<span class="n">sink</span><span class="o">.</span><span class="na">setBatchSize</span><span class="o">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">400</span><span class="o">);</span> <span class="c1">// this is 400 MB,</span>

<span class="n">input</span><span class="o">.</span><span class="na">addSink</span><span class="o">(</span><span class="n">sink</span><span class="o">);</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">input</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">Tuple2</span><span class="o">[</span><span class="kt">IntWritable</span>, <span class="kt">Text</span><span class="o">]]</span> <span class="k">=</span> <span class="o">...</span>

<span class="k">val</span> <span class="n">sink</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">RollingSink</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&quot;/base/path&quot;</span><span class="o">)</span>
<span class="n">sink</span><span class="o">.</span><span class="n">setBucketer</span><span class="o">(</span><span class="k">new</span> <span class="nc">DateTimeBucketer</span><span class="o">(</span><span class="s">&quot;yyyy-MM-dd--HHmm&quot;</span><span class="o">))</span>
<span class="n">sink</span><span class="o">.</span><span class="n">setWriter</span><span class="o">(</span><span class="k">new</span> <span class="nc">SequenceFileWriter</span><span class="o">[</span><span class="kt">IntWritable</span>, <span class="kt">Text</span><span class="o">]())</span>
<span class="n">sink</span><span class="o">.</span><span class="n">setBatchSize</span><span class="o">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">400</span><span class="o">)</span> <span class="c1">// this is 400 MB,</span>

<span class="n">input</span><span class="o">.</span><span class="n">addSink</span><span class="o">(</span><span class="n">sink</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p>This will create a sink that writes to bucket files that follow this schema:</p>

<div class="highlight"><pre><code>/base/path/{date-time}/part-{parallel-task}-{count}
</code></pre></div>

<p>Where <code>date-time</code> is the string that we get from the date/time format, <code>parallel-task</code> is the index
of the parallel sink instance and <code>count</code> is the running number of part files that where created
because of the batch size.</p>

<p>For in-depth information, please refer to the JavaDoc for
<a href="http://flink.apache.org/docs/latest/api/java/org/apache/flink/streaming/connectors/fs/RollingSink.html">RollingSink</a>.</p>

      <div class="footer">
      发现错误？想参与编辑？
      <a href="https://github.com/wuchong/flink-china-doc/edit/master/apis/streaming/connectors/hdfs.md" target="_blank">
        在 Github 上编辑此页！
      </a>
    </div>
    </div>
  </div>

  
</div>

    </div><!-- /.container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="/page/js/codetabs.js"></script>

    <!-- Google Analytics -->
    <!-- script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script -->

    <!-- Baidu Analytics -->
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?835985ad7943d8c24bc3c1f155b7d4a2";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    </script>


    <!-- Disqus -->
    
  </body>
</html>
